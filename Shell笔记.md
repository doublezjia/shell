# Shell学习笔记


## 基本使用

### 注释

`#` 表示注释

`#!` 第一行用`#!`表示告诉shell用什么shell来运行脚本

### 运行

脚本运行前要在文件上加上可执行的权限

例如全部加上可执行就是`a+x`，后加脚本名
```
chmod a+x <name>
```

运行时候，通过`路径加脚本名`，把脚本文件的确切位置告诉shell，这样来运行

如运行本目录下的脚本test.sh:
```
./test.sh
```

### 显示内容

`echo` 后加字符串输出内容

```
 echo This is a test
```

`echo`命令可用单引号或双引号来划定文本字符串。如果在字符串中用到了它们，你需要在文本中使用其中一种引号，而用另外一种来将字符串划定起来。

```
echo 'Rich says "scripting is easy".'
```

>如果想把文本字符串和命令输出显示在同一行中，可以用`echo`语句的`-n`参数。
>
>`echo`后加 `-e`激活转义

使用`-e`选项时，若字符串中出现以下字符，则特别加以处理，而不会将它当成一般文字输出：

- \a 发出警告声；
- \b 删除前一个字符； 
- \c 最后不加上换行符号； 
- \f 换行但光标仍旧停留在原来的位置； 
- \n 换行且光标移至行首； 
- \r 光标移至行首，但不换行； 
- \t 插入tab； 
- \v 与\f相同； 
- \\ 插入\字符； 
- \nnn 插入nnn（八进制）所代表的ASCII字符；

用`echo`命令打印带有色彩的文字
```
echo -e '\033[1;31;40m This is red text\033[0m'
```
>`\033[1;31;40m`：`1`是显示方式(可选)，`31`是字体颜色，`40m`是字体背景颜色
>
>`\033[0m`：取消颜色设置，恢复终端默认颜色。

```
字体颜色
0：默认
30：黑
31：红
32：绿
33：黄
34：蓝
35：紫
36：深绿
37：白

背景颜色
0：默认
40：黑
41：深红
42：绿
43：黄
44：蓝
45：紫
46：深绿
47：白

显示方式
0：终端默认设置
1：高亮显示
4：下划线
5：闪烁
7：反白显示
8：隐藏
```


### 变量

Shell使用变量，只需在变量前加上`$`。只要脚本在引号中出现美元符`$`，它就会以为你在引用一个变量。要显示美元符，你必须在它前面放置一个反斜线。

####环境变量

shell维护着一组环境变量，用来记录特定的系统信息。比如系统的名称、登录到系统上的用户名、用户的系统ID（也称为UID）、用户的默认主目录以及shell查找程序的搜索路径。可以用set命令来显示一份完整的当前环境变量列表。

在脚本中，你可以在环境变量名称之前加上美元符（$）来使用这些环境变量。

如
```
echo "User info for userid: $USER"
echo UID: $UID
echo HOME: $HOME
```

>`$USER`、`$UID`和`$HOME`环境变量用来显示已登录用户的有关信息。


####用户变量

用户变量可以是任何由字母、数字或下划线组成的文本字符串，长度不超过20个。用户变量区分大小写，所以变量Var1和变量var1是不同的。

使用等号将值赋给用户变量。在变量、等号和值之间不能出现空格。

使用等号将值赋给用户变量。在变量、等号和值之间不能出现空格

shell脚本会自动决定变量值的数据类型。

用户变量可通过美元符引用。

变量每次被引用时，都会输出当前赋给它的值。

#### 命令替换

两种方法可以将命令输出赋给变量：   

- 反引号字符 `    
- $()格式

>要注意反引号字符，这可不是用于字符串的那个普通的单引号字符。 通常在`左边键盘数字1`的左边

####输出重定向

将命令的输出发送到一个文件中。bash shell用大于号（>）来完成这项功能

- `>` 输出内容到文件
- `>>` 追加内容到文件

####输入重定向

输入重定向和输出重定向正好相反。输入重定向将文件的内容重定向到命令，而非将命令的输出重定向到文件。

- `<` 输出文件内容到命令
- `<<` 内联输入重定向

>内联输入重定向符号是远小于号`<<`。除了这个符号，你必须指定一个文本标记来划分输入数据的开始和结尾。任何字符串都可作为文本标记，但在数据的开始和结尾文本标记必须一致。

####执行数学运算

- `expr`命令，允许在命令行上处理数学表达式，但是特别笨拙。

- `$[]`使用方括号运算,推荐这个方法

>使用`expr`时有些符号(如*)需要通过`\`转义才可以用，使用`$[]`就不会


####退出状态码

Linux提供了一个专门的变量`$?`来保存上个已执行命令的退出状态码。

|状态码|描述|
|:---:|:---:|
|0|命令成功结束|
|1|一般性未知错误|
|2|不适合的shell命令|
|126|命令不可执行|
|127|没找到命令|
|128|无效的退出参数|
|128+x|与Linux信号x相关的严重错误|
|130|通过Ctrl+C终止的命令|
|255|正常范围之外的退出状态码|


>默认情况下，shell脚本会以脚本中的最后一个命令的退出状态码退出。
>可以通过`exit`命令来修改脚本的退出状态码。如`exit 1`这样


## Shell 结构化命令

### if-then语句

语法：
```
if command;then    
	commands
fi

或者
if command
then    
	commands
fi
```

>bash shell的if语句会运行if后面的那个命令。如果该命令的退出状态码是0（该命令成功运行），位于then部分的命令就会被执行。如果该命令的退出状态码是其他值，then部分的命令就不会被执行，bash shell会继续执行脚本中的下一个命令。fi语句用来表示if-then语句到此结束。

### if-then-else语句

语法
```
if command;then    
	commands
else
	commands
fi
```
>当`if`不成立时执行`else`语句。

当有多个条件判断的时候可以嵌套`if-then`语句在`else`中，或者使用`elif`

语法：
```
if command1
then
	commands
elif command2
then 
	commands
fi
```

### test命令

test命令提供了在if-then语句中测试不同条件的途径。

test命令的格式非常简单
```
test condition
```

>condition是test命令要测试的一系列参数和值。
>如果不写test命令的condition部分，它会以非零的退出状态码退出


test命令可以判断三类条件：   
- 数值比较   
- 字符串比较   
- 文件比较

### 数值比较

|比较|描述|
|:---|:---|
|n1 -eq n2|检查n1与n2是否相等|
|n1 -ge n2|检查n1是否大于或等于n2|
|n1 -gt n2|检查n1是否大于n2|
|n1 -le n2|检查n1是否小于或等于n2|
|n1 -lt n2|检查n1是否小于n2|
|n1 -ne n2|检查n1是否不等于n2|

### 字符串比较

|比较|描述|
|:---|:---|
|str1 = str2|检查str1是否与str2相同|
|str1 != str2|检查str1是否与str2不同|
|str1 < str2|检查str1是否比str2小|
|str1 > str2|检查str1是否比str2大|
| -n str1 | 检查str1的长度是否非0|
| -z str1 | 检查str1的长度是否为0|

>用大于号和小于号比较时要通过`\`反斜杠进行转义，不然shell会以为是重定向

### 文件比较

|比较|描述|
|:---|:---|
|-d file|检查file是否存在并是一个目录|
|-e file|检查file是否存在|
|-f file|检查file是否存在并是一个文件|
|-r file|检查file是否存在并可读|
|-s file|检查file是否存在并非空|
|-w file|检查file是否存在并可写|
|-x file|检查file是否存在并可执行|
|-O file|检查file是否存在并属当前用户所有|
|-G file|检查file是否存在并默认组与当前用户相同|
|file1 -nt file2|检查file是否比file2新|
|file1 -ot file2|检查file是否比file2旧|

###逻辑运算符

- && 和的意思
- || 或的意思

### if-then的高级特性

bash shell提供了两项可在if-then语句中使用的高级特性：   
- 用于数学表达式的双括号   
- 用于高级字符串处理功能的双方括号

>双括号命令允许你在比较过程中使用高级数学表达式，不需要将双括号中表达式里的大于号转义。

双括号命令符号

|符号|描述|
|:---|:---|
|val++|后增|
|val--|后减|
|++val|先增|
|--val|先减|
|！|逻辑求反|
|~|位求反|
|**|幂运算|
|<<|左位移|
|>>|右位移|
|&|位布尔和|
| &#124; |位布尔或|
|&&|逻辑和|
| &#124;&#124; |逻辑或|

>双方括号命令提供了针对字符串比较的高级特性。

####case 判断

case命令会采用列表格式来检查单个变量的多个值。

case命令会将指定的变量与不同模式进行比较。如果变量和模式是匹配的，那么shell会执行为该模式指定的命令。可以通过竖线操作符在一行中分隔出多个模式模式。星号会捕获所有与已知模式不匹配的值。

####for循环

语法：
```
for var in list
do    
	commands
done
```

